{% extends "base.html" %}
{% load static %}

{% block title %}Meu Perfil | Airways{% endblock %}

{% block content %}
<div class="profile-container">
    
    {# HEADER SIMPLIFICADO #}
    <div class="profile-nav">
        <a href="{% url 'menu' %}" class="back-link">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div class="user-id-badge">
            <div class="id-text">
                <small>ID DE CONTA</small>
                <span>{{ request.user.phone_number }}</span>
            </div>
            <div class="avatar-icon">
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </div>

    {# CONTEÚDO PRINCIPAL #}
    <div class="profile-content">
        
        {% if messages %}
            {% for message in messages %}
                <div class="msg-alert {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}

        {# LISTA DE BOTÕES (UM POR LINHA) #}
        <div class="profile-menu-list">
            
            <button class="menu-btn" onclick="toggleSection('bank-form')">
                <div class="btn-left">
                    <div class="icon-box bank-bg"><i class="fas fa-university"></i></div>
                    <span>Configurar Agência</span>
                </div>
                <i class="fas fa-chevron-right"></i>
            </button>

            <div id="bank-form" class="hidden-section">
                <form method="post" class="inner-form">
                    {% csrf_token %}
                    <div class="input-field">
                        <label>Nome do Titular</label>
                        {{ form.account_holder_name }}
                    </div>
                    <div class="input-field">
                        <label>Instituição Bancária</label>
                        {{ form.bank_name }}
                    </div>
                    <div class="input-field">
                        <label>IBAN da Conta</label>
                        {{ form.IBAN }}
                    </div>
                    <button type="submit" name="update_bank" class="save-btn">SALVAR ALTERAÇÕES</button>
                </form>
            </div>

            <button class="menu-btn" onclick="toggleSection('history-section')">
                <div class="btn-left">
                    <div class="icon-box history-bg"><i class="fas fa-receipt"></i></div>
                    <span>Histórico de Extrato</span>
                </div>
                <i class="fas fa-chevron-right"></i>
            </button>

            <div id="history-section" class="hidden-section">
                <div class="history-list">
                    {% for record in withdrawal_records %}
                    <div class="hist-item">
                        <small>{{ record.created_at|date:"d/m/Y" }}</small>
                        <strong>- {{ record.amount }} KZ</strong>
                        <span class="st-{{ record.status|lower }}">{{ record.status }}</span>
                    </div>
                    {% empty %}
                    <p class="empty-msg">Nenhum registro encontrado.</p>
                    {% endfor %}
                </div>
            </div>

            <a href="{% static 'app/airways.apk' %}" class="menu-btn">
                <div class="btn-left">
                    <div class="icon-box download-bg"><i class="fas fa-cloud-download-alt"></i></div>
                    <span>Baixar Aplicativo</span>
                </div>
                <i class="fas fa-download"></i>
            </a>

            <a href="{% url 'logout' %}" class="menu-btn logout-btn">
                <div class="btn-left">
                    <div class="icon-box logout-bg"><i class="fas fa-sign-out-alt"></i></div>
                    <span>Encerrar Sessão</span>
                </div>
            </a>
        </div>

    </div>
</div>

<style>
    /* RESET E FUNDO */
    html, body { margin: 0; padding: 0; width: 100%; overflow-x: hidden; }
    
    body {
        background: url("{% static 'images/background_airways.jpg' %}") center center fixed !important;
        background-size: cover !important;
        font-family: 'Poppins', sans-serif;
        color: white;
    }

    .profile-container {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        min-height: 100vh;
        background: rgba(2, 6, 12, 0.9);
        padding: 20px 15px;
        box-sizing: border-box;
    }

    /* HEADER */
    .profile-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
    }
    .back-link { color: #fff; font-size: 20px; text-decoration: none; }
    
    .user-id-badge {
        display: flex;
        align-items: center;
        gap: 12px;
        background: rgba(255,255,255,0.05);
        padding: 8px 15px;
        border-radius: 50px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .id-text { text-align: right; }
    .id-text small { display: block; font-size: 8px; color: #00ff88; font-weight: 800; letter-spacing: 1px; }
    .id-text span { font-size: 13px; font-weight: 700; color: #fff; }
    .avatar-icon { font-size: 28px; color: #00ff88; }

    /* MENU LIST */
    .profile-menu-list { display: flex; flex-direction: column; gap: 12px; }

    .menu-btn {
        width: 100%;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 15px;
        padding: 12px 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: white;
        text-decoration: none;
        cursor: pointer;
        transition: 0.3s;
    }
    .menu-btn:active { transform: scale(0.98); background: rgba(255,255,255,0.1); }

    .btn-left { display: flex; align-items: center; gap: 15px; }
    .btn-left span { font-size: 14px; font-weight: 600; }

    /* ICON BOXES */
    .icon-box {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
    }
    .bank-bg { background: rgba(0, 123, 255, 0.2); color: #007bff; }
    .history-bg { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
    .download-bg { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
    .logout-bg { background: rgba(255, 82, 82, 0.2); color: #ff5252; }

    /* FORMULÁRIO ESCONDIDO */
    .hidden-section {
        display: none;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-top: -5px;
        border: 1px solid rgba(255,255,255,0.05);
        animation: slideDown 0.3s ease-out;
    }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    .inner-form .input-field { margin-bottom: 15px; }
    .inner-form label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; }
    .inner-form input {
        width: 100%;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        padding: 12px;
        border-radius: 8px;
        color: white;
        box-sizing: border-box;
    }
    .save-btn {
        width: 100%;
        background: #00ff88;
        color: #000;
        border: none;
        padding: 12px;
        border-radius: 8px;
        font-weight: 800;
        cursor: pointer;
    }

    /* HISTÓRICO */
    .hist-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        font-size: 12px;
    }
    .st-pendente { color: #ffc107; }
    .st-aprovado { color: #00ff88; }

    .msg-alert {
        padding: 12px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
        font-size: 13px;
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid #00ff88;
        color: #00ff88;
    }
</style>

<script>
    function toggleSection(id) {
        const section = document.getElementById(id);
        const isVisible = section.style.display === 'block';
        
        // Fecha todas as outras antes de abrir a nova
        document.querySelectorAll('.hidden-section').forEach(s => s.style.display = 'none');
        
        section.style.display = isVisible ? 'none' : 'block';
    }
</script>
{% endblock %}
